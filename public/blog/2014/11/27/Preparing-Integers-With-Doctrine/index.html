<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Preparing Integers With Doctrine &middot; Nicholas J</title>

  
  <link rel="stylesheet" href="http://redstalker.com/css/poole.css">
  <link rel="stylesheet" href="http://redstalker.com/css/hyde.css">
  <link rel="stylesheet" href="http://redstalker.com/css/poole-overrides.css">
  <link rel="stylesheet" href="http://redstalker.com/css/hyde-overrides.css">
  <link rel="stylesheet" href="http://redstalker.com/css/hyde-x.css">
  <link rel="stylesheet" href="http://redstalker.com/css/highlight/sunburst.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://redstalker.com/apple-touch-icon-144-precomposed.png">
  <link href="http://redstalker.com/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="How do you add integers as prepared statements to a select?">
  <meta name="keywords" content="nicholas johns,home,website,blog,golang,docker,php">
  
</head>
<body class="theme-base-08">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <img src="https://www.gravatar.com/avatar/dc6e8fcb5d2bf3a94b850f295b4102c6?s=200" alt="gravatar">
      <h1>Nicholas J</h1>
      <p class="lead">Another random programmer&rsquo;s blog</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="http://redstalker.com/">Blog</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/taion809"><i class="fa fa-github-square fa-3x"></i></a>
      
      
      
      
      <a href="https://twitter.com/taion809"><i class="fa fa-twitter-square fa-3x"></i></a>
      </li>
    </ul>

    <p>Copyright &copy; 2015 <a href="http://redstalker.com/license/">License</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1>Preparing Integers With Doctrine</h1>
    <span class="post-date">Nov 27, 2014 &middot; 1 minute read &middot; <a href="http://redstalker.com/blog/2014/11/27/preparing-integers-with-doctrine/#disqus_thread">Comments</a>
    
    <br/>
    <a class="label" href="http://redstalker.com/categories/development">Development</a>
    </span>
    <p>I recently had an issue with binding an integer to a select statement with doctrine and postgresql.</p>

<p>Given the following:</p>

<pre><code>&lt;?php
    $sql = 'INSERT INTO tree (ancestor, descendant)
            SELECT cta.ancestor, :descendant
            FROM tree AS cta
            WHERE cta.descendant = :ancestor
            UNION ALL
            SELECT :descendant, :descendant';

    $statement = $connection-&gt;prepare($sql);
    $statement-&gt;bindValue(&quot;descendant&quot;, (int) $rootNode, 'integer');
    $statement-&gt;bindValue(&quot;ancestor&quot;, (int) $ancestor, 'integer');
    $statement-&gt;execute();
?&gt;
</code></pre>

<p>I received the following error:</p>

<pre><code>/**
    PHP Fatal error:  Uncaught exception 'PDOException' with message 'SQLSTATE[42P08]: Ambiguous parameter: 7 ERROR:  inconsistent types deduced for parameter $1
    LINE 2:                 SELECT cta.ancestor, $1
                                                          ^
    DETAIL:  integer versus text' in /vagrant_data/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/PDOStatement.php:91
*/
</code></pre>

<p>The solution was to explicitly cast it as an integer like so ::integer</p>

<p>And here is the revised code:</p>

<pre><code>&lt;?php
    $sql = 'INSERT INTO tree (ancestor, descendant)
            SELECT cta.ancestor, :descendant::integer
            FROM tree AS cta
            WHERE cta.descendant = :ancestor
            UNION ALL
            SELECT :descendant, :descendant';

    $statement = $connection-&gt;prepare($sql);
    $statement-&gt;bindValue(&quot;descendant&quot;, (int) $rootNode, 'integer');
    $statement-&gt;bindValue(&quot;ancestor&quot;, (int) $ancestor, 'integer');
    $statement-&gt;execute();
?&gt;
</code></pre>

<p>If there are errors or you have a suggestion send me a message @taio.</p>

  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "redstalker";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "redstalker";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="http://redstalker.com/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
  var _gaq=[['_setAccount','UA-43022143-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>

