<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Preparing Integers With Doctrine &middot; Nicholas Johns</title>

  
  <link rel="stylesheet" href="http://localhost:1313/css/poole.css">
  <link rel="stylesheet" href="http://localhost:1313/css/hyde.css">
  <link rel="stylesheet" href="http://localhost:1313/css/poole-overrides.css">
  <link rel="stylesheet" href="http://localhost:1313/css/hyde-overrides.css">
  <link rel="stylesheet" href="http://localhost:1313/css/hyde-x.css">
  <link rel="stylesheet" href="http://localhost:1313/css/highlight/sunburst.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link href="/favicon.png" rel="icon">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Redstalker &middot; Nicholas Johns" />

  <meta name="description" content="How do you add integers as prepared statements to a select?">
  <meta name="keywords" content="">
  
</head>
<body class="theme-base-08">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1>Nicholas Johns</h1>
      
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="http://localhost:1313/">Blog</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="https://github.com/taion809">GitHub</a></li>
      
      
      
      <li class="sidebar-nav-item"><a href="taion809">Twitter</a></li>
    </ul>

    <p>Copyright &copy; 2015 <a href="http://localhost:1313/license">License</a><br/>
       Powered by <a href="http://hugo.spf13.com">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>
  </div>
</div>

<div class="content container">
  <div class="post">
    <h1>Preparing Integers With Doctrine</h1>
    <p>I recently had an issue with binding an integer to a select statement with doctrine and postgresql.</p>

<p>Given the following:</p>

<pre><code>&lt;?php
    $sql = 'INSERT INTO tree (ancestor, descendant)
            SELECT cta.ancestor, :descendant
            FROM tree AS cta
            WHERE cta.descendant = :ancestor
            UNION ALL
            SELECT :descendant, :descendant';

    $statement = $connection-&gt;prepare($sql);
    $statement-&gt;bindValue(&quot;descendant&quot;, (int) $rootNode, 'integer');
    $statement-&gt;bindValue(&quot;ancestor&quot;, (int) $ancestor, 'integer');
    $statement-&gt;execute();
?&gt;
</code></pre>

<p>I received the following error:</p>

<pre><code>/**
    PHP Fatal error:  Uncaught exception 'PDOException' with message 'SQLSTATE[42P08]: Ambiguous parameter: 7 ERROR:  inconsistent types deduced for parameter $1
    LINE 2:                 SELECT cta.ancestor, $1
                                                          ^
    DETAIL:  integer versus text' in /vagrant_data/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/PDOStatement.php:91
*/
</code></pre>

<p>The solution was to explicitly cast it as an integer like so ::integer</p>

<p>And here is the revised code:</p>

<pre><code>&lt;?php
    $sql = 'INSERT INTO tree (ancestor, descendant)
            SELECT cta.ancestor, :descendant::integer
            FROM tree AS cta
            WHERE cta.descendant = :ancestor
            UNION ALL
            SELECT :descendant, :descendant';

    $statement = $connection-&gt;prepare($sql);
    $statement-&gt;bindValue(&quot;descendant&quot;, (int) $rootNode, 'integer');
    $statement-&gt;bindValue(&quot;ancestor&quot;, (int) $ancestor, 'integer');
    $statement-&gt;execute();
?&gt;
</code></pre>

<p>If there are errors or you have a suggestion send me a message @taio.</p>

  </div>
</div>
<script src="http://localhost:1313/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>